<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NFT Tycoon</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root{ --bg:#050505; --glass:rgba(255,255,255,.06); --primary:#00d2ff; --accent:#9d50bb; --green:#00ff88; }
        body{ margin:0; background:radial-gradient(circle,#1a1a2e,#050505); color:#fff; font-family:sans-serif; display:flex; flex-direction:column; align-items:center; height:100vh; overflow:hidden; }
        .top{ margin-top:20px; display:flex; justify-content:space-between; width:90%; z-index:10; }
        .balance{ background:var(--glass); padding:8px 16px; border-radius:20px; color:var(--green); font-weight:800; border:1px solid rgba(0,255,136,0.2); }
        .screen{ display:none; flex-direction:column; align-items:center; width:100%; height:100%; padding-bottom:90px; position:absolute; top:0; }
        .screen.active{ display:flex; }
        .btn{ padding:14px 30px; border:none; border-radius:18px; background:linear-gradient(135deg,var(--primary),var(--accent)); color:#fff; font-weight:800; cursor:pointer; }
        .nav{ position:fixed; bottom:20px; background:rgba(0,0,0,.8); padding:12px 25px; border-radius:30px; display:flex; gap:25px; z-index:100; border:1px solid rgba(255,255,255,0.1); }
        .nav div{ font-size:1.4rem; opacity:.3; cursor:pointer; }
        .nav .active{ opacity:1; color:var(--primary); transform:scale(1.2); }
        .grid{ display:grid; grid-template-columns:1fr 1fr; gap:10px; width:90%; margin-top:80px; max-height:60vh; overflow-y:auto; }
        .card{ background:var(--glass); padding:15px; border-radius:20px; text-align:center; border:1px solid rgba(255,255,255,0.05); }
        .card img{ width:50px; }
        .small-btn{ font-size:.65rem; padding:4px 8px; margin-top:5px; background:rgba(255,255,255,0.1); border:1px solid var(--primary); color:white; border-radius:5px; }
        .list{ width:90%; margin-top:80px; max-height:60vh; overflow-y:auto; }
        .item{ display:flex; justify-content:space-between; align-items:center; background:var(--glass); padding:12px; border-radius:15px; margin-bottom:8px; }

        /* –†–£–õ–ï–¢–ö–ê */
        .roulette-container { position: relative; width: 100%; height: 140px; background: rgba(255,255,255,0.03); border-top: 2px solid var(--primary); border-bottom: 2px solid var(--primary); margin-top: 100px; overflow: hidden; display: none; }
        .roulette-track { display: flex; position: absolute; left: 0; top: 0; height: 100%; transition: transform 5s cubic-bezier(0.15, 0, 0.15, 1); }
        .roulette-item { width: 120px; height: 100%; flex-shrink: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; border-right: 1px solid rgba(255,255,255,0.05); }
        .roulette-item img { width: 60px; height: 60px; }
        .pointer { position: absolute; left: 50%; top: 0; width: 4px; height: 100%; background: var(--green); z-index: 10; box-shadow: 0 0 15px var(--green); transform: translateX(-50%); }
        #debug-log { font-size: 10px; color: #555; position: fixed; top: 0; width: 100%; text-align: center; }
    </style>
</head>
<body>

<div id="debug-log">–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã...</div>

<div class="top">
    <div class="balance">üí∞ <span id="coins">...</span></div>
    <div style="font-weight:900; font-size:.7rem; color:var(--primary)">NFT TYCOON</div>
</div>

<div id="case" class="screen active">
    <div id="roulette" class="roulette-container">
        <div class="pointer"></div>
        <div id="track" class="roulette-track"></div>
    </div>
    <img id="caseStaticImg" src="https://cdn-icons-png.flaticon.com/512/6161/6161301.png" width="180" style="margin-top:100px;cursor:pointer">
    <h3 id="status">–ö–ï–ô–° –ì–û–¢–û–í</h3>
    <button id="openBtn" class="btn" onclick="openCase()">–û–¢–ö–†–´–¢–¨ (50)</button>
</div>

<div id="inv" class="screen">
    <h2 style="margin-top:60px">üéí –ò–ù–í–ï–ù–¢–ê–†–¨</h2>
    <div class="grid" id="invGrid"></div>
</div>

<div id="market" class="screen">
    <h2 style="margin-top:60px">‚öñÔ∏è –ú–ê–†–ö–ï–¢</h2>
    <div class="list" id="marketList"></div>
</div>

<div id="top-screen" class="screen">
    <h2 style="margin-top:60px">üèÜ –¢–û–ü</h2>
    <div class="list" id="topList"></div>
</div>

<div class="nav">
    <div class="active" onclick="show('case',this)">üì¶</div>
    <div onclick="show('inv',this)">üéí</div>
    <div onclick="show('market',this)">‚öñÔ∏è</div>
    <div onclick="show('top-screen',this)">üèÜ</div>
</div>

<script>
    const tg = window.Telegram.WebApp;
    // –°—Ä–∞–∑—É —Å–æ–æ–±—â–∞–µ–º Telegram, —á—Ç–æ –º—ã –≥–æ—Ç–æ–≤—ã
    tg.ready();
    tg.expand();

    const SERVER_URL = "https://41ce26c1ca617b9a-92-63-106-58.serveousercontent.com";
    const API_URL = SERVER_URL + "/api";

    const itemData = {
        "Common Bot": {img:"https://cdn-icons-png.flaticon.com/512/4712/4712139.png",price:20},
        "Rare Cyber": {img:"https://cdn-icons-png.flaticon.com/512/4712/4712109.png",price:100},
        "Ultra Legend": {img:"https://cdn-icons-png.flaticon.com/512/4712/4712095.png",price:500},
        "Gold Dragon": {img:"https://cdn-icons-png.flaticon.com/512/4712/4712102.png",price:1500}
    };

    let MY_ID = null;
    let coins = 0, myInv = [], isSpinning = false;

    // –§—É–Ω–∫—Ü–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
    async function initApp() {
        const log = document.getElementById("debug-log");
        
        // –ü—ã—Ç–∞–µ–º—Å—è –≤–∑—è—Ç—å ID –∏–∑ —Ä–∞–∑–Ω—ã—Ö –º–µ—Å—Ç Telegram
        const user = tg.initDataUnsafe?.user;
        
        if (user && user.id) {
            MY_ID = String(user.id);
            log.innerText = "–ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω: " + user.first_name + " (ID: " + MY_ID + ")";
            log.style.color = "#00ff88";
            await loadData();
        } else {
            // –ï—Å–ª–∏ ID –Ω–µ—Ç, –ø—Ä–æ–±—É–µ–º –ø–æ–¥–æ–∂–¥–∞—Ç—å –µ—â–µ —Å–µ–∫—É–Ω–¥—É
            log.innerText = "–û–∂–∏–¥–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ—Ç Telegram... (–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∑–∞—à–ª–∏ —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É)";
            log.style.color = "orange";
            setTimeout(initApp, 1000); 
        }
    }

    async function loadData() {
        if (!MY_ID) return;
        try {
            const r = await fetch(`${API_URL}?user_id=${MY_ID}`);
            const d = await r.json();

            if (d.error === "not_registered") {
                document.body.innerHTML = "<div style='text-align:center;padding:50px;'><h2>üì± –ù–æ–º–µ—Ä –Ω–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω</h2><p>–í–µ—Ä–Ω–∏—Ç–µ—Å—å –≤ –±–æ—Ç–∞ –∏ –Ω–∞–∂–º–∏—Ç–µ '–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é'</p></div>";
                return;
            }

            coins = d.balance;
            myInv = d.inventory || [];
            document.getElementById("coins").innerText = coins;
            renderInv();
        } catch(e) { 
            document.getElementById("debug-log").innerText = "–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞: –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Å—ã–ª–∫—É —Ç—É–Ω–Ω–µ–ª—è";
        }
    }

    // --- –û—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (renderInv, sellBot, openCase, loadTop, show) –æ—Å—Ç–∞–≤—å –∏–∑ –ø—Ä–æ—à–ª–æ–≥–æ –∫–æ–¥–∞ ---
    // ... (–∫–æ–ø–∏—Ä—É–π –∏—Ö —Å—é–¥–∞) ...

    // –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ
    initApp();
</script>
</body>
</html>


