<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NFT Deluxe Web</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --primary: #00d2ff; --accent: #9d50bb; --bg: #050505; --glass: rgba(255, 255, 255, 0.1); }
        body { background: radial-gradient(circle at center, #1a1a2e 0%, #050505 100%); color: white; font-family: 'Segoe UI', sans-serif; margin: 0; display: flex; flex-direction: column; align-items: center; height: 100vh; overflow: hidden; }
        
        /* –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å */
        .top-bar { width: 90%; display: flex; justify-content: space-between; align-items: center; margin-top: 20px; }
        .balance-box { background: var(--glass); padding: 10px 15px; border-radius: 15px; border: 1px solid rgba(255,255,255,0.1); font-weight: bold; color: #00ff88; }
        .inv-btn { background: var(--glass); border: 1px solid var(--primary); color: white; padding: 10px; border-radius: 12px; font-size: 1.2rem; cursor: pointer; }

        /* –ù–æ–≤–æ—Å—Ç–∏ */
        #update-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); backdrop-filter: blur(15px); display: flex; align-items: center; justify-content: center; z-index: 200; }
        .modal-content { background: linear-gradient(135deg, #1e2a3a, #000); padding: 25px; border-radius: 20px; border: 1px solid var(--primary); width: 85%; text-align: center; }

        /* –ö–µ–π—Å */
        .case-scene { position: relative; margin-top: 60px; width: 260px; height: 260px; display: flex; align-items: center; justify-content: center; }
        .case-glow { position: absolute; width: 100%; height: 100%; background: var(--primary); filter: blur(60px); opacity: 0.3; border-radius: 50%; }
        .case-img { width: 220px; z-index: 2; transition: transform 0.3s; }
        .spinning { animation: shake 0.5s infinite ease-in-out; }
        @keyframes shake { 0% { transform: rotate(0); } 25% { transform: rotate(5deg); } 75% { transform: rotate(-5deg); } 100% { transform: rotate(0); } }

        /* –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å */
        #inventory-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); backdrop-filter: blur(20px); display: none; flex-direction: column; align-items: center; z-index: 100; padding-top: 40px; }
        .inv-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; width: 90%; max-height: 70vh; overflow-y: auto; padding: 10px; }
        .inv-card { background: var(--glass); padding: 15px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.1); text-align: center; font-size: 0.8rem; }
        .inv-card img { width: 50px; display: block; margin: 0 auto 5px; }

        .btn { background: linear-gradient(90deg, var(--primary), var(--accent)); border: none; padding: 15px 40px; border-radius: 15px; color: white; font-weight: bold; cursor: pointer; margin-top: 20px; }
    </style>
</head>
<body>

    <div id="update-modal">
        <div class="modal-content">
            <h2 style="color: var(--primary);">–í–ï–†–°–ò–Ø 1.3</h2>
            <p>‚úÖ –ü–æ–ª–Ω–∞—è –∞–≤—Ç–æ–Ω–æ–º–Ω–æ—Å—Ç—å (–±–µ–∑ —Å–ø–∞–º–∞ –±–æ—Ç–∞)</p>
            <p>‚úÖ –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º</p>
            <p>‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –¥–∏–∑–∞–π–Ω –∫–∞—Ä—Ç–æ—á–µ–∫</p>
            <button class="btn" onclick="closeModal()">–ò–ì–†–ê–¢–¨</button>
        </div>
    </div>

    <div class="top-bar">
        <div class="balance-box">üí∞ <span id="coins">1000</span></div>
        <button class="inv-btn" onclick="toggleInventory()">üéí</button>
    </div>

    <div class="case-scene">
        <div class="case-glow" id="glow"></div>
        <img src="https://cdn-icons-png.flaticon.com/512/6161/6161301.png" id="main-img" class="case-img">
    </div>

    <h2 id="status">–ö–ï–ô–° –ì–û–¢–û–í</h2>
    <button class="btn" id="roll-btn" onclick="openCase()">–û–¢–ö–†–´–¢–¨ (50)</button>

    <div id="inventory-modal">
        <h1>üéí –¢–í–û–ô –ò–ù–í–ï–ù–¢–ê–†–¨</h1>
        <div class="inv-grid" id="inv-grid"></div>
        <button class="btn" onclick="toggleInventory()" style="background: #333;">–ù–ê–ó–ê–î</button>
    </div>

    <script>
    const tg = window.Telegram.WebApp;
    tg.expand();
    tg.enableClosingConfirmation(); // –°–ø—Ä–æ—Å–∏—Ç –ø–µ—Ä–µ–¥ –≤—ã—Ö–æ–¥–æ–º, —á—Ç–æ–±—ã —Å–ª—É—á–∞–π–Ω–æ –Ω–µ –∑–∞–∫—Ä—ã—Ç—å

    // 1. –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö (–µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç, —Å—Ç–∞–≤–∏–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ)
    let coins = parseInt(localStorage.getItem('coins'));
    if (isNaN(coins)) coins = 1000;

    let myItems = [];
    try {
        const savedItems = localStorage.getItem('myItems');
        myItems = savedItems ? JSON.parse(savedItems) : [];
    } catch (e) {
        myItems = [];
    }

    const items = [
        { name: "Common Bot", img: "https://cdn-icons-png.flaticon.com/512/4712/4712139.png", color: "#00d2ff" },
        { name: "Rare Cyber", img: "https://cdn-icons-png.flaticon.com/512/4712/4712109.png", color: "#9d50bb" },
        { name: "Ultra Legend", img: "https://cdn-icons-png.flaticon.com/512/4712/4712095.png", color: "#ffcc00" }
    ];

    // 2. –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
    function updateUI() {
        document.getElementById('coins').innerText = coins;
        localStorage.setItem('coins', coins.toString());
        localStorage.setItem('myItems', JSON.stringify(myItems));
    }

    function closeModal() { 
        document.getElementById('update-modal').style.display = 'none'; 
        updateUI(); 
    }

    function toggleInventory() { 
        const m = document.getElementById('inventory-modal');
        const isOpening = m.style.display !== 'flex';
        m.style.display = isOpening ? 'flex' : 'none';
        if(isOpening) renderInv();
    }

    function openCase() {
        if (coins < 50) { 
            tg.showPopup({message: "–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç!"}); 
            return; 
        }
        
        coins -= 50;
        updateUI();
        
        const btn = document.getElementById('roll-btn');
        const img = document.getElementById('main-img');
        const status = document.getElementById('status');

        btn.disabled = true;
        img.classList.add('spinning');
        status.innerText = "–û–¢–ö–†–´–í–ê–ï–ú...";

        // –ò–º–∏—Ç–∞—Ü–∏—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∏
        setTimeout(() => {
            img.classList.remove('spinning');
            const win = items[Math.floor(Math.random() * items.length)];
            
            img.src = win.img;
            status.innerText = win.name;
            status.style.color = win.color;

            // –°–û–•–†–ê–ù–Ø–ï–ú –í –ò–ù–í–ï–ù–¢–ê–†–¨ (–ë–ï–ó –ó–ê–ö–†–´–¢–ò–Ø –ò–ì–†–´)
            myItems.push(win); 
            updateUI();

            btn.disabled = false;
            tg.HapticFeedback.notificationOccurred('success');

            // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–æ—Ä–æ–±–∫—É —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
            setTimeout(() => {
                if (!btn.disabled) { // –ï—Å–ª–∏ –Ω–µ –Ω–∞—á–∞–ª–∏ –Ω–æ–≤—É—é –ø—Ä–æ–∫—Ä—É—Ç–∫—É
                    img.src = "https://cdn-icons-png.flaticon.com/512/6161/6161301.png";
                    status.innerText = "–ö–ï–ô–° –ì–û–¢–û–í";
                    status.style.color = "white";
                }
            }, 3000);
        }, 2000);
    }

    function renderInv() {
        const grid = document.getElementById('inv-grid');
        grid.innerHTML = "";
        if (myItems.length === 0) {
            grid.innerHTML = "<p style='grid-column: 1/3'>–ò–Ω–≤–µ–Ω—Ç–∞—Ä—å –ø—É—Å—Ç</p>";
            return;
        }
        myItems.forEach((item, index) => {
            const card = document.createElement('div');
            card.className = "inv-card";
            card.style.border = `1px solid ${item.color}`;
            card.innerHTML = `
                <img src="${item.img}" style="width: 60px; height: 60px;">
                <div style="margin-top: 5px; font-weight: bold;">${item.name}</div>
            `;
            grid.appendChild(card);
        });
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
    updateUI();
</script>
</body>
</html>

