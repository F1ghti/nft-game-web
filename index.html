<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NFT Tycoon</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --bg:#050505; --primary:#00d2ff; --green:#00ff88; }
        body { margin:0; background:#050505; color:#fff; font-family:sans-serif; display:flex; flex-direction:column; align-items:center; height:100vh; }
        .balance { margin-top:20px; background:rgba(255,255,255,0.1); padding:10px 20px; border-radius:20px; color:var(--green); }
        .btn { margin-top:20px; padding:15px 30px; background:var(--primary); border:none; border-radius:15px; color:#000; font-weight:bold; }
        #debug-info { font-size: 10px; color: gray; margin-top: 10px; }
    </style>
</head>
<body>

<div class="balance">üí∞ <span id="coins">...</span></div>
<div id="debug-info">–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...</div>

<div id="game-content" style="display:none; text-align:center;">
    <h2 style="margin-top:50px;">NFT Tycoon</h2>
    <img src="https://cdn-icons-png.flaticon.com/512/6161/6161301.png" width="150">
    <br>
    <button class="btn" onclick="openCase()">–û–¢–ö–†–´–¢–¨ –ö–ï–ô–° (50)</button>
</div>

<script>
    const tg = window.Telegram.WebApp;
    tg.ready();
    tg.expand();

    // –°—Å—ã–ª–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä (–ü–ï–†–ï–ü–†–û–í–ï–†–¨ –ï–Å!)
    const SERVER_URL = "https://41ce26c1ca617b9a-92-63-106-58.serveousercontent.com";
    const API_URL = SERVER_URL + "/api";

    function startApp() {
        const user = tg.initDataUnsafe?.user;
        const debug = document.getElementById("debug-info");

        if (!user) {
            debug.innerText = "–û—à–∏–±–∫–∞: Telegram –Ω–µ –ø–µ—Ä–µ–¥–∞–ª –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.";
            // –í—Ä–µ–º–µ–Ω–Ω–∞—è –º–µ—Ä–∞: –µ—Å–ª–∏ ID –Ω–µ—Ç, –ø–æ–ø—Ä–æ–±—É–µ–º –≤—Å—ë —Ä–∞–≤–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–ª—è —Ç–µ—Å—Ç–∞
            // –ù–æ –≤ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ —Ç—É—Ç –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—à–∏–±–∫–∞
            return;
        }

        const MY_ID = String(user.id);
        debug.innerText = "–ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –∫–∞–∫ ID: " + MY_ID;
        document.getElementById("game-content").style.display = "block";

        loadData(MY_ID);
    }

    async function loadData(uid) {
        try {
            const r = await fetch(`${API_URL}?user_id=${uid}`);
            const d = await r.json();
            
            if(d.error === "not_registered") {
                document.body.innerHTML = "<h2>–ù—É–∂–Ω–∞ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –≤ –±–æ—Ç–µ!</h2>";
                return;
            }
            
            document.getElementById("coins").innerText = d.balance;
        } catch(e) {
            document.getElementById("debug-info").innerText = "–û—à–∏–±–∫–∞ —Å–≤—è–∑–∏ —Å —Å–µ—Ä–≤–µ—Ä–æ–º";
        }
    }

    async function openCase() {
        const user = tg.initDataUnsafe?.user;
        if (!user) return;
        
        await fetch(API_URL, {
            method: "POST",
            body: JSON.stringify({ action: "open_case", user_id: String(user.id) })
        });
        loadData(String(user.id));
    }

    // –ó–∞–ø—É—Å–∫–∞–µ–º —Å –Ω–µ–±–æ–ª—å—à–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π, —á—Ç–æ–±—ã Telegram —É—Å–ø–µ–ª –ø—Ä–æ–∫–∏–Ω—É—Ç—å –¥–∞–Ω–Ω—ã–µ
    setTimeout(startApp, 500);

</script>
</body>
</html>
